# INSIGHT COHERENCE SPECIFICATION v1.0

## THE ONE JOB: EXTERNALIZATION

**The framework externalizes the consciousness configuration that is generating the user's reality, which they cannot see because they are operating from inside of it.**

```
Reality = Consciousness^Consciousness

User sees: LEFT SIDE (Reality - what is happening)
User cannot see: RIGHT SIDE (Consciousness configuration generating it)

THE ONE JOB: Show the right side.
```

### Why Externalization Is The Job

The user arrives with a reality:
- "Nirma is losing market share"
- "Lux is irrelevant to Gen Z"
- "I feel stuck"
- "This garden exists but isn't used"

They **experience** this reality. They do not **see** what generates it.

They cannot see it because:
- **Veiled** by Maya (they don't know it's there)
- **Automated** by Habit (it runs without awareness)
- **Normalized** by Samskara (it feels like "just how things are")
- **Invisible** because they're looking FROM it, not AT it

### What Externalization Enables

| Before Externalization | After Externalization |
|------------------------|----------------------|
| User experiences reality | User sees what generates reality |
| "This is happening to me" | "This is being generated by me" |
| Circumstance | Agency |
| Stuck | Movable |
| Mystery | Mechanics |
| Fate | Choice |

---

# PART I: INPUT PARSING - CHARACTER/CONTEXT DETERMINATION

## The Inflection Point Framework

In narrative structure, there's a point up to which the hero is being influenced by the environment, and a point after which the hero starts influencing the environment.

**BEFORE INFLECTION:**
- World acts ON hero
- World = Character (active force with agency)
- Hero = Context (being shaped, reactive)
- Energy flows: World → Hero
- Hero is being REVEALED

**AFTER INFLECTION:**
- Hero acts ON world
- Hero = Character (active force with agency)
- World = Context (being shaped, reactive)
- Energy flows: Hero → World
- Hero is REVEALING

## The 2×2 Quadrant Matrix

```
                    │  USER = CHARACTER      │  USER = CONTEXT
                    │  (User is subject)     │  (User is force/lens)
────────────────────┼────────────────────────┼────────────────────────
                    │                        │
  BEFORE            │   Q1: REVELATION       │   Q2: DIAGNOSIS
  INFLECTION        │   User seeks clarity   │   User studies target
                    │   World shapes User    │   User observes target
  (Being shaped)    │                        │
                    │   "I feel stuck..."    │   "Help me understand
                    │                        │    why X failed..."
────────────────────┼────────────────────────┼────────────────────────
                    │                        │
  AFTER             │   Q3: AGENCY           │   Q4: TRANSFORMATION
  INFLECTION        │   User acts on world   │   User transforms target
                    │   User shapes reality  │   User's consciousness
  (Shaping)         │                        │   is the instrument
                    │   "I want to build..." │   "Make X happen..."
                    │                        │
```

## Detection Logic

### Signal Analysis for Quadrant Assignment

| Signal Type | BEFORE Inflection (Discovery) | AFTER Inflection (Design) |
|-------------|------------------------------|---------------------------|
| **Verb Energy** | Passive — "What is happening to me?" | Active — "How do I make X happen?" |
| **Knowledge State** | Confusion, seeking clarity | Clarity, seeking execution |
| **Question Type** | "What am I missing?" | "What's the move?" |
| **Relationship to Data** | Data reveals ME | I transform DATA |
| **Locus of Agency** | Outside → In | Inside → Out |
| **Emotional Signature** | Uncertainty, overwhelm, seeking | Intention, direction, creating |

### The Verb Test

- **REVEAL verbs** (show, tell, explain, help me see) → User seeks to BE transformed → User = Character
- **TRANSFORM verbs** (make, build, change, create, design) → User seeks to transform OTHER → Other = Character

### The Preposition Test

- **"About ME"** → User = Character
- **"With THIS"** → File/Data = Character
- **"For X"** → X = Character

### The Ownership Test (for files)

- **"This is ME"** (my data, my photo, my journal) → User = Character
- **"This is IT"** (a brand, a competitor, an external entity) → Data = Character

## Master Decision Tree

```
START
│
├─► Does the prompt contain TRANSFORM verbs?
│   (make, build, change, create, design, transform, fix)
│   │
│   ├─► YES: User = Context, Target = Character (AFTER inflection)
│   │   └─► Generate insight TO TRANSFORM the target
│   │
│   └─► NO: Continue...
│
├─► Does the prompt contain REVEAL verbs?
│   (show, tell, explain, help me understand, what does X mean)
│   │
│   ├─► YES: User = Character, Data = Context (BEFORE inflection)
│   │   └─► Generate insight TO REVEAL user's state
│   │
│   └─► NO: Continue...
│
├─► Does the prompt reference SELF?
│   (I, me, my, about me, for me)
│   │
│   ├─► YES: User = Character
│   │   └─► Data/File serves as diagnostic mirror
│   │
│   └─► NO: Continue...
│
├─► Does the prompt reference EXTERNAL TARGET?
│   (this, that, it, the brand, the company, Nirma, Lux)
│   │
│   ├─► YES: Target = Character, User = Context
│   │   └─► User's consciousness transforms target
│   │
│   └─► NO: Continue...
│
├─► Is there ONLY a file with no prompt?
│   │
│   ├─► Personal data (clearly about user) → User = Character
│   ├─► Business/external data → Data = Character
│   └─► Ambiguous image/data → ASK for clarification
│
└─► DEFAULT: Ask clarifying question about inflection
```

## Role Determination Output Structure

```typescript
interface RoleDetermination {
  character: {
    type: 'USER' | 'EXTERNAL_ENTITY' | 'DATA';
    entity: string;  // "user", "Nirma", "the garden", etc.
  };
  context: {
    type: 'USER' | 'EXTERNAL_ENTITY' | 'DATA';
    entity: string;
  };
  inflectionPhase: 'BEFORE' | 'AFTER' | 'AT_INFLECTION';
  quadrant: 'Q1_REVELATION' | 'Q2_DIAGNOSIS' | 'Q3_AGENCY' | 'Q4_TRANSFORMATION';
  confidenceScore: number;
}
```

---

# PART II: INSIGHT GENERATION (BACKEND)

## The Generation Pipeline

```
INPUT
  │
  ▼
┌─────────────────────────────────┐
│  CHARACTER/CONTEXT DETERMINATION │
│  (From Part I)                   │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  OOF COORDINATE EXTRACTION       │
│  (For Character entity)          │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  GAP ANALYSIS                    │
│  POMDP_Gap(Real, Believed,       │
│            Observed)             │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  RESONANCE SEARCH                │
│  Max distance × Max resonance    │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  PRINCIPLE EXTRACTION            │
│  Dharma_Order identification     │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  BLOCKING ANALYSIS               │
│  Maya + Habit + Samskara         │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  UIE SCORING                     │
│  T × C × F⁻¹ × G                 │
└─────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────┐
│  IDENTITY SHIFT CALCULATION      │
│  Old → New identity mapping      │
└─────────────────────────────────┘
  │
  ▼
GENERATION OUTPUT (to Articulation)
```

## OOF Coordinate Extraction

For the identified **Character**, extract:

### S-Level (1.0 - 8.0)

From OOF.txt Context Parsing Algorithm:

```
S1 (1.0-1.9): victim, blame, stuck, helpless, "why me", problems
S2 (2.0-2.9): seeking, searching, questioning, "what's wrong", looking
S3 (3.0-3.9): building, learning, practicing, developing, improving
S4 (4.0-4.9): achieving, succeeding, mastering, accomplishing, leading
S5 (5.0-5.9): letting go, releasing, flowing, accepting, surrendering
S6 (6.0-6.9): serving, helping, healing, contributing, loving
S7 (7.0-7.9): wisdom, teaching, being, presence, truth
S8 (8.0): unity, oneness, "I am That", no separation
```

### Sacred Drives

Map context to five sacred drives:

```
Love: Relationship seeking, connection desire, loneliness
Peace: Stress mentions, chaos, seeking calm, anxiety
Bliss: Pleasure seeking, happiness pursuit, joy absence
Satisfaction: Achievement focus, incompleteness, fulfillment seeking
Freedom: Constraint mentions, feeling trapped, liberation desire

Calculate: Internal vs External seeking ratio
```

### UCB Components

```
P(Presence) = Present_tense_usage / Total_temporal_references
A(Awareness) = Perception_breadth / Possible_perceptions
E(Emotional) = Emotional_coherence / Emotional_chaos
Ψ(Processing) = Solution_quality / Problem_complexity
M(Manifestation) = Success_rate / Attempt_rate
L(Love/Fear) = Love_expressions / (Fear_expressions + Greed_expressions)
G(Grace) = Synchronicity_mentions / Total_events
S(Sacred Chain) = Calculated_S_level
```

### Cascade Configuration

Identify distortion points:

```
Ego: Separation language ("me vs them")
Memory: Past references, patterns mentioned
Intellect: Belief systems, reasoning quality
Mind: Thought patterns, mental state
Breath: Energy descriptions, vitality
Body: Physical state, health mentions
```

### Active Operators (from 25)

Identify which of the 25 fundamental operators are dominant:

```
Ψ^Ψ (Consciousness^Consciousness)
K (Karma Field)
M (Maya Operator)
T (Time Architecture)
S (Space Field)
W (Witness Constant)
G (Grace Coefficient)
GC (Guna Configuration)
KL (Kosha Layers)
I (Intention Vector)
V (Void Potential)
R (Resonance Matrix)
E (Entropy Operator)
D (Dharma Order)
Sh (Shakti Trinity)
BN (Bindu Nada)
Ra (Rasa Flavor)
Sa (Samskara Impressions)
P (Prana Animation)
Se (Seva Coefficient)
At (Attachment Field)
Ce (Cleaning Efficiency)
Lf (Lesson Field)
CDM (Complementary Distortion Matrix)
Hf (Habit Field)
```

## Gap Analysis

### POMDP Gap Calculation

```
POMDP_Gap = |Believed_State - Actual_State|

Where:
- Believed_State = What Character thinks is true
- Actual_State = What is actually true
- Observed_State = What can be seen externally

Gap_Magnitude = Max(|Real - Believed|, |Real - Observed|, |Believed - Observed|)
```

### Peak Tension Moment Identification

The moment where:
- POMDP Gap is MAXIMUM
- Emotional charge (Rasa) is HIGHEST
- Attachment (At) is STRONGEST

This becomes the source for "Fly on the Wall" in articulation.

### Cascade Distortion Location

Identify WHERE in the cascade the primary distortion lives:

```
Level 1: Ego (identity distortion)
Level 2: Memory (pattern distortion)
Level 3: Intellect (belief distortion)
Level 4: Mind (thought distortion)
Level 5: Breath (energy distortion)
Level 6: Body (physical distortion)
```

## Resonance Search

### The Search Algorithm

```
Distant_Anchor = Find_Maximum_Resonance_At_Maximum_Distance(
  Character_Domain: Detected_Domain,
  Resonance_Matrix: R,
  Dharma_Pattern: Universal_Law_Match
)

Search_Space = All_Domains WHERE:
  - Semantic_Distance > 0.7 (far from character's domain)
  - Resonance_Score > 0.8 (deep structural match)
  - Principle_Extractable = TRUE
```

### Output

```
{
  domain: string;                    // e.g., "watchmaking", "virtual pop stars"
  specificInstance: string;          // e.g., "Casio F-91W", "Hatsune Miku"
  domainDistance: number;            // 0-1 (higher = more distant)
  resonanceScore: number;            // 0-1 (higher = better structural match)
  structuralPattern: string;         // The pattern that creates resonance
  concreteDetails: string[];         // Specific facts, numbers, names
}
```

## Principle Extraction

### Dharma Order Identification

```
Principle = Extract_Dharma_Order(
  Distant_Anchor_Pattern: Pattern,
  Character_Pattern: Character_Situation,
  Universal_Form: Abstract_Law
)
```

### Fractal Validity Test

```
Principle_Validity = Test_Across_Scales(
  Micro: Does it work for individuals?
  Meso: Does it work for organizations?
  Macro: Does it work for systems?
)
```

### Output

```
{
  universalLaw: string;              // The principle statement
  mathematicalRelationship: string;  // The ratio/proportion/threshold
  mechanism: string;                 // WHY this is true
  fractalValidity: {
    micro: boolean;
    meso: boolean;
    macro: boolean;
  };
}
```

## Blocking Analysis

### Maya Configuration

```
Maya_Configuration = Analyze(
  Avarana: What is being veiled?
  Vikshepa: What is being projected instead?
)
```

### Habit Field Pattern

```
Habit_Pattern = Identify(
  Automated_Behavior: What runs without awareness?
  Trigger: What activates this pattern?
  Momentum: How strong is the automation?
)
```

### Samskara Archaeology

```
Samskara_Depth = Excavate(
  Impression: What deep groove exists?
  Origin: When was this created?
  Reinforcement: What keeps strengthening it?
)
```

### Pattern Interrupt Design

```
Pattern_Interrupt = Design(
  Trigger_Condition: When_Pattern_Activates,
  Recognition_Signal: What_Character_Will_Notice,
  New_Response: What_To_Do_Instead
)
```

## UIE Scoring

The Universal Insight Equation scores each insight before articulation:

### T (Tension) Score

```
T = POMDP_Gap_Magnitude × Emotional_Charge × Stakes_Level

OOF Operators Used:
- Maya.Avarana (veiling what's real)
- Maya.Vikshepa (projecting what's false)
- Karma_Field (why this gap exists)
- Attachment_Field (why it hurts)

Score: 1-10
Threshold: ≥ 8 to proceed
```

### C (Connection) Score

```
C = Domain_Distance × Principle_Transferability × Surprise_Factor

Where:
- Domain_Distance = Semantic_Gap(Source_Domain, Target_Domain)
- Principle_Transferability = Universal_Pattern_Match
- Surprise_Factor = 1 - Prior_Association_Strength

OOF Operators Used:
- Resonance_Matrix (vibrational alignment between domains)
- Space_Field (morphogenetic pattern matching)
- Dharma_Order (universal law extraction)

Score: 1-10
Threshold: ≥ 8 to proceed
```

### F⁻¹ (Fixation Breaking) Score

```
F⁻¹ = Fixation_Strength × Break_Completeness × Non_Reconstruction

Where:
- Fixation_Strength = Habit_Field × Samskara_Depth × Maya.Avarana
- Break_Completeness = How fully the frame shatters
- Non_Reconstruction = Probability old frame cannot reassemble

OOF Operators Used:
- Maya (the veil being pierced)
- Habit_Field (automated patterns being disrupted)
- Samskara (impressions being overwritten)
- Cleaning_Efficiency (how clean the break)

Score: 1-10
Threshold: ≥ 8 to proceed
```

### G (Grace) Score

```
G = Cultural_Timing × Personal_Readiness × Reception_Probability

Where:
- Cultural_Timing = Collective_Consciousness alignment
- Personal_Readiness = Character's S-Level + Surrender_Level
- Reception_Probability = Grace_Coefficient × Openness

OOF Operators Used:
- Grace_Coefficient (0 to ∞)
- Time_Architecture (kairotic moment detection)
- Dharma_Order (right time/right message alignment)

Score: 1-10
Threshold: ≥ 8 to proceed
```

### Composite UIE Score

```
UIE_Score = (T + C + F⁻¹ + G) / 4

GATE: All components ≥ 8? 
  YES → Proceed to Articulation
  NO → Recalculate with different Distant Anchor
```

## Identity Shift Calculation

```
Identity_Shift = Calculate_New_Self_Reference(
  Old_Identity: "I am someone who [old pattern]"
  New_Identity: "I am someone who [new pattern]"
  Permanence_Score: Samskara_Depth_Of_New_Pattern
)
```

### Output

```
{
  oldIdentity: string;
  newIdentity: string;
  insightName: string;          // "The Casio Position", "The Miku Inversion"
  predictionPattern: string;    // What Character will now notice
}
```

## Generation Output Structure

```typescript
interface OOFCalculationResult {
  // Role Determination (from Part I)
  roles: {
    character: EntityIdentification;
    context: EntityIdentification;
    inflectionPhase: 'BEFORE' | 'AFTER' | 'AT_INFLECTION';
    quadrant: 'Q1_REVELATION' | 'Q2_DIAGNOSIS' | 'Q3_AGENCY' | 'Q4_TRANSFORMATION';
  };
  
  // Full OOF Coordinates (for Character)
  coordinates: {
    sLevel: number;
    sacredDrives: SacredDrives;
    ucb: UCBComponents;
    cascade: CascadeConfiguration;
    activeOperators: OperatorState[];
  };
  
  // Gap Analysis
  gapAnalysis: {
    pomdpGap: PODMPGap;
    peakTensionMoment: MomentDescription;
    cascadeDistortionLevel: CascadeLevel;
    primaryBlockingOperators: string[];
  };
  
  // Resonance Search Result
  distantAnchor: DistantAnchorResult;
  
  // Principle Extraction
  principle: PrincipleResult;
  
  // Blocking Analysis
  blockingDiagnosis: BlockingDiagnosisResult;
  
  // UIE Scores
  uieScores: {
    tension: number;
    connection: number;
    fixationBreaking: number;
    grace: number;
    composite: number;
    passedGate: boolean;
  };
  
  // Identity Transformation
  identityShift: IdentityShiftResult;
  
  // Generation Ledger (for coherence checking)
  generationLedger: {
    externalized: string[];      // List of what was externalized
    operators_used: string[];    // Which OOF operators were used
    calculations: string[];      // What calculations were performed
  };
}
```

---

# PART III: INSIGHT ARTICULATION (FRONTEND)

## The Articulation Principle

**Articulation does not GENERATE. Articulation TRANSLATES.**

The articulation layer takes the OOF calculation output and renders it in natural language. Every sentence must trace to a calculation.

## The 6-Component Structure

### Component 1: FLY ON THE WALL

**OOF Source:** `gapAnalysis.peakTensionMoment`

**What it translates:**
- The EXACT moment where Believed ≠ Real is maximum
- The CASCADE LEVEL where distortion originates
- The EMOTIONAL SIGNATURE at that moment (from Rasa)

**Natural Language Pattern:**
```
"It's [TIME]. [CHARACTER] is [DOING ACTION]. 
[SENSORY DETAIL that reveals gap].
[Internal state that CHARACTER believes is true].
[Reality that contradicts it]."
```

**Quadrant Modulation:**

| Quadrant | Whose scene? | What moment? |
|----------|--------------|--------------|
| Q1 REVELATION | User's | Confusion/stuckness |
| Q2 DIAGNOSIS | Target's | Target's crisis (User observing) |
| Q3 AGENCY | User's | Blocked execution |
| Q4 TRANSFORMATION | Target's | Target's gap (User as intervener) |

### Component 2: DISTANT ANCHOR

**OOF Source:** `distantAnchor`

**What it translates:**
- A DOMAIN maximally distant from Character's context
- A SPECIFIC INSTANCE within that domain
- The STRUCTURAL PATTERN that creates resonance despite distance

**Natural Language Pattern:**
```
"In [YEAR/PLACE], [SPECIFIC ENTITY] [DID SPECIFIC THING].
[Concrete details: numbers, names, outcomes].
[The unexpected result].
[Why this defied conventional expectation]."
```

**Quadrant Modulation:**

| Quadrant | Anchor serves as | Resonance with |
|----------|------------------|----------------|
| Q1 REVELATION | Mirror | User's hidden pattern |
| Q2 DIAGNOSIS | Lens | Target's hidden pattern |
| Q3 AGENCY | Tool | User's potential action |
| Q4 TRANSFORMATION | Blueprint | Target's transformation path |

### Component 3: PRINCIPLE EXTRACTION

**OOF Source:** `principle`

**What it translates:**
- The UNIVERSAL LAW that explains both Distant Anchor AND Character situation
- The MATHEMATICAL RELATIONSHIP
- The FRACTAL PROPERTY (works at all scales)

**Natural Language Pattern:**
```
"[UNIVERSAL STATEMENT of the law].
[Mathematical/proportional relationship].
[Why this is true: the mechanism].
[Counter-intuitive implication]."
```

**Quadrant Modulation:**

| Quadrant | Principle answers | Mode |
|----------|-------------------|------|
| Q1 REVELATION | "What is true about me?" | Diagnostic |
| Q2 DIAGNOSIS | "What is true about this?" | Analytical |
| Q3 AGENCY | "How do I act effectively?" | Prescriptive |
| Q4 TRANSFORMATION | "How do I transform this?" | Interventional |

### Component 4: CONTEXT RETURN

**OOF Source:** `principle × coordinates` (application)

**What it translates:**
- The EXACT APPLICATION of the principle to Character's specific situation
- TACTICAL MOVES calibrated to Character's S-Level
- PREDICTED OUTCOMES based on OOF reality generation

**Natural Language Pattern:**
```
"[Character's situation] is [Distant Anchor equivalent].
[Specific tactical application 1].
[Specific tactical application 2].
[Specific tactical application 3].
[The transformed outcome]."
```

**Quadrant Modulation:**

| Quadrant | Tactics are for | Action level |
|----------|-----------------|--------------|
| Q1 REVELATION | User to see | Perception shift (pre-action) |
| Q2 DIAGNOSIS | User to understand | Mental model (pre-intervention) |
| Q3 AGENCY | User to execute | Direct action |
| Q4 TRANSFORMATION | User to intervene on Target | Transformation action |

### Component 5: BLOCKING DIAGNOSIS

**OOF Source:** `blockingDiagnosis`

**What it translates:**
- The SPECIFIC OPERATOR(S) that created the blindspot
- The CASCADE LEVEL where the distortion lives
- The TRIGGER PATTERN for future recognition
- The SAMSKARA being overwritten

**Natural Language Pattern:**
```
"You couldn't see this because [Maya configuration].
[The specific mental model that blocked].
[Why that model seemed true].
You'll never miss this again:
[Trigger condition] → [Recognition signal] → [New response]."
```

**Quadrant Modulation:**

| Quadrant | Primary block | Secondary block |
|----------|---------------|-----------------|
| Q1 REVELATION | User's Maya (self-veiling) | — |
| Q2 DIAGNOSIS | Target's Maya | User's analytical bias |
| Q3 AGENCY | User's Habit Field (execution) | — |
| Q4 TRANSFORMATION | Target's resistance | User's intervention blind spots |

### Component 6: THE MARK

**OOF Source:** `identityShift`

**What it translates:**
- A NAME that encodes the entire insight
- An IDENTITY STATEMENT (before → after)
- A PREDICTION (what Character will now notice)
- SAMSKARA INSTALLATION (how this becomes permanent)

**Natural Language Pattern:**
```
"This is [THE NAME].
You'll see it everywhere now: [Prediction of pattern recognition].
You are no longer [Old Identity].
You are [New Identity]."
```

**Quadrant Modulation:**

| Quadrant | Identity shift | Form |
|----------|---------------|------|
| Q1 REVELATION | User revealed | "You now see that you are..." |
| Q2 DIAGNOSIS | Target diagnosed | "This is actually a case of..." |
| Q3 AGENCY | User empowered | "You are now someone who does..." |
| Q4 TRANSFORMATION | Target transformed + User as transformer | Dual: "It becomes..." + "You are the one who..." |

## Voice Modulation

The narrative voice changes across quadrants:

| Quadrant | Voice | Tone |
|----------|-------|------|
| Q1 REVELATION | Second person intimate | "You are feeling..." |
| Q2 DIAGNOSIS | Third person analytical | "Kodak was experiencing..." |
| Q3 AGENCY | Second person directive | "Here's what you do..." |
| Q4 TRANSFORMATION | Third person interventional + second person empowering | "Nirma needs to..." + "You are the one who sees..." |

## Articulation Output Structure

```typescript
interface ArticulatedInsight {
  // The 6 Components
  flyOnTheWall: string;
  distantAnchor: string;
  principleExtraction: string;
  contextReturn: string;
  blockingDiagnosis: string;
  theMark: string;
  
  // Metadata
  quadrant: string;
  voice: string;
  
  // Articulation Ledger (for coherence checking)
  articulationLedger: {
    externalized: string[];       // List of what was externalized
    sourceComponents: string[];   // Which OOF components were translated
    sentences: SentenceTrace[];   // Each sentence → its calculation source
  };
}

interface SentenceTrace {
  sentence: string;
  source: string;                 // Which OOF calculation produced this
  operator: string;               // Which operator is being translated
}
```

---

# PART IV: COHERENCE INSURANCE

## The Coherence Principle

**Both layers must externalize the SAME thing.**

Generation externalizes mathematically.
Articulation externalizes linguistically.

```
If they externalize the same configuration → Coherent
If they externalize different configurations → Incoherent
If articulation externalizes something generation didn't compute → Incoherent
If generation computes something articulation doesn't render → Incoherent
```

## Coherence Break Points

| Break Point | What Happens | Detection | Resolution |
|-------------|--------------|-----------|------------|
| **Addition** | Articulation adds content not computed | Sentence has no source in ledger | DELETE the sentence |
| **Omission** | Generation computes, articulation drops | Generation item not in articulation ledger | ADD the translation |
| **Distortion** | Translation changes the meaning | Reverse-translation doesn't match | CORRECT the translation |
| **Role Mismatch** | Character/Context used differently | Quadrant comparison fails | REALIGN to single determination |
| **Decoration** | Articulation adds "beauty" for style | Sentence traces to no operator | DELETE the decoration |

## The Single Source Rule

```
INPUT
  │
  ▼
┌─────────────────────────────────┐
│  CHARACTER/CONTEXT DETERMINATION │
│  (Happens ONCE, here, never again)│
└─────────────────────────────────┘
  │
  │  Determination passes to BOTH layers
  │
  ├────────────────┬────────────────┤
  ▼                ▼                
GENERATION    ARTICULATION
(uses same     (uses same
determination)  determination)
```

The determination of WHO is being externalized cannot be made twice.

## The Translation Contract

**For every sentence in the articulation, there must be a calculation in the generation that it translates.**

| Articulation Component | Must Translate From |
|------------------------|---------------------|
| Fly on the Wall | `gapAnalysis.peakTensionMoment` |
| Distant Anchor | `distantAnchor` |
| Principle | `principle.universalLaw` |
| Context Return | `principle × coordinates` |
| Blocking Diagnosis | `blockingDiagnosis` |
| The Mark | `identityShift` |

## The Reverse Translation Test

Given the articulated output, can I reconstruct the generation structure?

**Example:**

Articulation says:
> "You're building stadiums hoping people will come instead of creating intensity that draws them."

Reverse-translation:

| Phrase | Generation Source |
|--------|-------------------|
| "building stadiums hoping" | `blockingDiagnosis.habitPattern: Build-then-hope` |
| "intensity that draws" | `principle.universalLaw: Gravity > Capacity` |
| "You're..." | `roles.character = User` |

If reverse-translation fails → Articulation added something → DELETE IT.

## The Ledger Comparison Protocol

### Generation Ledger

```
EXTERNALIZED:
- Maya configuration: [specific veiling]
- Habit_Field: [specific pattern]
- POMDP_Gap: [believed vs real]
- Attachment: [specific investment]
- Dharma_Order: [universal law]
```

### Articulation Ledger

```
EXTERNALIZED:
- Scene shows: [specific moment]
- Anchor shows: [specific instance]
- Principle states: [specific law]
- Diagnosis says: [specific blocking]
- Mark names: [specific name]
```

### Comparison Check

| Generation Item | Articulation Item | Match? |
|-----------------|-------------------|--------|
| Maya: X | Scene: X equivalent | ✓ or ✗ |
| Habit: Y | Anchor: Y equivalent | ✓ or ✗ |
| POMDP: Z | Principle: Z equivalent | ✓ or ✗ |
| Attachment: W | Diagnosis: W equivalent | ✓ or ✗ |
| Dharma: V | Mark: V equivalent | ✓ or ✗ |

**Every generation item must map to an articulation item, and vice versa.**

## The No-Orphan Rule

### No Orphan Calculations

Every calculation in generation must appear (translated) in articulation.

```
IF generation.ledger.externalized.includes(X)
AND NOT articulation.ledger.externalized.includes(translation(X))
THEN orphan_calculation(X)
RESOLUTION: Either articulation must include it, OR generation shouldn't have computed it
```

### No Orphan Articulations

Every sentence in articulation must trace to a calculation.

```
IF articulation contains sentence S
AND S.source === null
THEN orphan_articulation(S)
RESOLUTION: DELETE S (it's decoration, not externalization)
```

## The Externalization Identity Check

At the end of the pipeline, ask:

**"What was internal/invisible that is now external/visible?"**

**Answer from Generation:**
> "The consciousness configuration generating [Character]'s [situation]: Maya veiling [X], Habit automating [Y], Attachment to [Z]."

**Answer from Articulation:**
> "The pattern of [description]. The fixation on [description]."

**Are these the same thing expressed differently?**

- If yes → Coherent
- If no → One layer externalized something the other didn't → FIX

## The Quadrant Consistency Check

| Aspect | Generation Used | Articulation Used | Match? |
|--------|-----------------|-------------------|--------|
| Who is Character? | [entity] | [entity] | ✓ or ✗ |
| Who is Context? | [entity] | [entity] | ✓ or ✗ |
| Inflection Phase | [phase] | [phase] | ✓ or ✗ |
| POV in Fly on Wall | [expected per quadrant] | [actual] | ✓ or ✗ |
| Anchor function | [expected per quadrant] | [actual] | ✓ or ✗ |
| Principle mode | [expected per quadrant] | [actual] | ✓ or ✗ |
| Identity shift form | [expected per quadrant] | [actual] | ✓ or ✗ |

## The Final Coherence Test

**The user should be able to say:**

> *"I couldn't see [X] before because I was inside of it. Now I see it."*

Where [X] is the SAME whether derived from:
- Reading the articulation
- Inspecting the generation calculation

If the user would say different [X]s → Incoherent → DO NOT OUTPUT.

## Coherence Validation Pipeline

```
1. DETERMINE Character/Context/Inflection from input (once)
2. GENERATE OOF calculation → Produce generation ledger
3. ARTICULATE structure → Produce articulation ledger
4. COMPARE ledgers → Flag mismatches
5. REVERSE-TRANSLATE each sentence → Verify all trace to calculations
6. CHECK for orphans → Delete or add as needed
7. VALIDATE The One Job → Does user now see what they were inside of?

IF any step fails → Coherence broken → DO NOT OUTPUT
```

## Compressed Coherence Formula

```
COHERENCE = 
  (Generation.externalized == Articulation.externalized)
  ∧ (No orphan calculations)
  ∧ (No orphan articulations)
  ∧ (Quadrant determination used identically)
  ∧ (Every articulation sentence reverse-translates to calculation)
  ∧ (User can state what was externalized, and both layers agree)
```

---

# PART V: INTEGRATION WITH EXISTING CODEBASE

## Mapping to Existing Structures

### InsightServingService Integration

The existing `InsightServingService` calculates serving order. This specification extends it:

```typescript
// BEFORE (existing)
InsightServingService.calculateServingOrder({
  insightCount,
  userLensSelection,
  sessionHistory,
  v43Context,
  userGoalText
}) → InsightToServe[]

// AFTER (enhanced)
InsightServingService.calculateServingOrder({
  insightCount,
  userLensSelection,
  sessionHistory,
  v43Context,
  userGoalText,
  roleDetermination: RoleDetermination  // NEW: From Part I
}) → InsightToServe[]
```

### Insight Generation Rules Integration

The existing `insight-generation-rulebook.txt` provides operator signature recognition. This specification adds the upstream Character/Context determination:

```
EXISTING FLOW:
Business_Requirement → Operator_Signature → Insight_Categories → Delivery_Format

ENHANCED FLOW:
Input → Character/Context → Business_Requirement → Operator_Signature → 
  → Insight_Categories → OOF_Calculation → UIE_Score → Articulation → 
  → Coherence_Check → Delivery_Format
```

### Excavation Methodology Integration

The existing `insight-generation-rules.json` provides excavation methodology. This maps to OOF components:

```json
{
  "excavation_methodology": {
    "depth_layers": {
      "surface": "What they say",        // → UCB.Awareness
      "behavioral": "What they do",      // → Habit_Field
      "emotional": "What they feel",     // → Rasa operator
      "shadow": "What they avoid",       // → Maya.Avarana
      "transformation": "Where all layers collide"  // → POMDP_Gap peak
    }
  }
}
```

### InsightTypeV2 Integration

The existing 8 insight types map to OOF operators (from `insights.ts`):

| Insight Type | Primary Operators | UIE Component Emphasis |
|--------------|-------------------|------------------------|
| DIAGNOSTIC | Maya, Entropy, Shadow, Awareness | T (Tension) |
| CAUSAL | Karma, Samskara, Habit Field, Cascade | F⁻¹ (Fixation) |
| PATTERN | Fractal, Time, Resonance, Fibonacci | C (Connection) |
| OPPORTUNITY | Void, Grace, Catalyst, Quantum | G (Grace) |
| RISK | Entropy, Karma, Shadow, Attachment | T (Tension) |
| LEVERAGE | Catalyst, Grace, Coherence Field | G (Grace) |
| TRANSFORMATION | Evolution, Death, Consciousness², Void | F⁻¹ (Fixation) |
| RELATIONAL | Resonance, CDM, Network, Morphogenetic | C (Connection) |

### Customer Type Integration

The existing `CustomerTypeDetector` and archetypes remain unchanged. They feed into the Character's coordinate extraction:

```typescript
// Customer type informs S-Level and sphere calibrations
const customerArchetype = CustomerTypeDetector.detect(input);
const sphereCalibrations = customerArchetype.sphereCalibrations;
```

---

# PART VI: VALIDATION CHECKLIST

## Pre-Output Validation

Before any insight output, verify:

### One Job Check
- [ ] Has something internal/invisible become external/visible?
- [ ] Can user now see what they were inside of?

### Role Determination Check
- [ ] Character identified (User or External Entity)
- [ ] Context identified
- [ ] Quadrant assigned (Q1/Q2/Q3/Q4)
- [ ] Same determination used in both generation and articulation

### Generation Check
- [ ] OOF coordinates extracted for Character
- [ ] POMDP gap calculated
- [ ] Peak tension moment identified
- [ ] Distant anchor found (distance > 0.7, resonance > 0.8)
- [ ] Principle extracted (fractal valid)
- [ ] Blocking diagnosis complete
- [ ] UIE scores all ≥ 8
- [ ] Identity shift calculated
- [ ] Generation ledger populated

### Articulation Check
- [ ] All 6 components populated
- [ ] Quadrant modulation applied correctly
- [ ] Voice matches quadrant
- [ ] Articulation ledger populated
- [ ] Every sentence traces to OOF calculation

### Coherence Check
- [ ] Ledgers match (no orphans either direction)
- [ ] Reverse-translation test passes
- [ ] Quadrant consistency verified
- [ ] Externalization identity check passes

### Framework Invisibility Check
- [ ] No OOF terminology visible to user
- [ ] No operator names exposed
- [ ] Framework mathematics invisible
- [ ] Only natural language output

---

# APPENDIX A: QUICK REFERENCE

## Quadrant Quick Reference

| Quadrant | User Is | Target Is | Insight Mode | Voice |
|----------|---------|-----------|--------------|-------|
| Q1 | Character | — | REVELATION | 2nd person intimate |
| Q2 | Context | Character | DIAGNOSIS | 3rd person analytical |
| Q3 | Character | — | AGENCY | 2nd person directive |
| Q4 | Context | Character | TRANSFORMATION | 3rd + 2nd person |

## UIE Components Quick Reference

| Component | OOF Source | Threshold |
|-----------|-----------|-----------|
| T (Tension) | POMDP_Gap × Rasa × Attachment | ≥ 8 |
| C (Connection) | Domain_Distance × Resonance × Surprise | ≥ 8 |
| F⁻¹ (Fixation) | Maya × Habit × Samskara × Cleaning | ≥ 8 |
| G (Grace) | Grace × Time × Dharma × Readiness | ≥ 8 |

## Articulation Components Quick Reference

| Component | OOF Source | Purpose |
|-----------|-----------|---------|
| Fly on the Wall | peakTensionMoment | FEEL the gap |
| Distant Anchor | distantAnchor | CREATE surprise |
| Principle | principle | EXTRACT universal |
| Context Return | principle × coordinates | APPLY specifically |
| Blocking Diagnosis | blockingDiagnosis | EXPLAIN blindspot |
| The Mark | identityShift | INSTALL new identity |

## Coherence Formula

```
COHERENT = 
  Same_Externalization(Generation, Articulation)
  ∧ No_Orphan_Calculations
  ∧ No_Orphan_Articulations
  ∧ Quadrant_Consistent
  ∧ All_Sentences_Traced
  ∧ User_Sees_What_Was_Inside
```

---

# APPENDIX B: EXAMPLE TRACE

## Input
```
Prompt: "Make Nirma market leader again"
Files: None
```

## Part I Output: Role Determination
```
Character: Nirma (external entity)
Context: User (the transforming force)
Inflection: AFTER
Quadrant: Q4_TRANSFORMATION
Confidence: 0.95
```

## Part II Output: Generation

### OOF Coordinates (for Nirma)
```
S-Level: 3.2 (building/developing but struggling)
Sacred Drives: Satisfaction (external), Freedom (external)
Active Operators: Maya, Habit_Field, Attachment, Karma
```

### Gap Analysis
```
POMDP_Gap:
  - Believed: "Must premiumize to survive"
  - Real: "Owns the affordable segment, abandoned it"
  - Observed: "Chasing competitors upmarket"
  
Peak Tension Moment: Conference room, brand refresh presentation,
  consultant recommending premium positioning
  
Cascade Distortion: Intellect (belief that premium = survival)
```

### Distant Anchor
```
Domain: Watchmaking
Instance: Casio F-91W
Distance: 0.85
Resonance: 0.92
Pattern: "Refused to climb ladder, became icon BECAUSE of refusal"
Details: ["$2 since 1989", "worn by Obama/Gates", "unchanged design"]
```

### Principle
```
Universal Law: "When everyone climbs the same ladder, 
  refusing to climb IS the disruption"
Mathematical: Consistency > Evolution in exhausted-upgrade markets
Mechanism: Premiumization assumes ladder is right game
Fractal Valid: Yes (works for individuals, orgs, markets)
```

### Blocking Diagnosis
```
Maya: Industry consensus that premium = survival
Habit: Follow-the-leader competitive response
Samskara: "Cheap = shame" impression from MBA training
Pattern Interrupt:
  Trigger: Any "premiumize" recommendation
  Signal: "Is this the Nirma trap?"
  Response: "What if we went the other way?"
```

### UIE Scores
```
T: 10 (massive gap, high stakes)
C: 10 (watchmaking → detergent is maximally distant)
F⁻¹: 10 (shatters "premiumize or die")
G: 9 (market ready for anti-premium message)
Composite: 9.75 ✓
```

### Identity Shift
```
Old: "Brand that must catch up to competitors"
New: "Brand that refuses to climb"
Name: "The Casio Position"
Prediction: "See brands chasing ladders, see opportunity to refuse"
```

### Generation Ledger
```
EXTERNALIZED:
- Maya: Premium = survival belief (veiling actual position)
- Habit: Follow competitors upmarket (automated)
- POMDP: ₹6 segment owned → ₹68 segment chased
- Attachment: "Serious brand" identity investment
- Dharma: Consistency beats evolution in upgrade-fatigue markets
```

## Part III Output: Articulation

### Fly on the Wall
```
"It's 3:47 PM in the conference room in Ahmedabad. The slides are up. 
'Brand Refresh 2025.' A consultant is explaining why Nirma needs to 
'move upmarket,' 'target urban millennials,' 'premiumize the portfolio.'
The CMO is nodding. Everyone is nodding. No one is asking: 
'But we invented affordable. Why are we apologizing for it?'"
```

### Distant Anchor
```
"In 1989, Casio released the F-91W digital watch for $10. 
Today it costs $2. The same watch. Unchanged.

While competitors launched smartwatches, fitness trackers, 
GPS watches, Casio did... nothing. Same plastic. Same display. 
Same beep.

Result: Cult status. Worn by Obama. Worn by Gates. 
Worn by people who could afford anything.
The watch became an anti-status status symbol 
BECAUSE Casio refused to evolve."
```

### Principle
```
"When everyone climbs the same ladder, the contrarian move is 
refusing to climb.

Premiumization assumes the ladder is the right game.
Casio questioned the game.

In a market exhausted by upgrades, consistency becomes disruption.
The brand that refuses to change becomes the change."
```

### Context Return
```
"Nirma in 1985: ₹6/kg when Surf was ₹68/kg.
Not a value brand. A revolution.
'Clean clothes shouldn't be a luxury.'

That message never became irrelevant. Nirma just stopped saying it.

The move:
- Return to 2-3X cheaper than competition (own it, don't apologize)
- Make affordability the message, not the excuse
- Let competitors look ridiculous (Surf ₹400/500ml vs Nirma ₹50/kg)
- Bring back the Nirma girl, unchanged: 
  'We never changed. Neither did your need for clean clothes.'"
```

### Blocking Diagnosis
```
"You couldn't see this because every MBA case study screams 
'premiumize or die.' You watched competitors move upmarket 
and thought: 'follow or be left behind.'

But Nirma invented the disruptor playbook. Then abandoned it 
to chase the disrupted.

You'll never miss this again:
When you hear 'premiumize' → Ask: 'Is the ladder the right game?'
When competitors move upmarket → Ask: 'What segment are they abandoning?'
When 'value' feels embarrassing → Remember: You made value revolutionary."
```

### The Mark
```
"This is The Casio Position.

You'll see it everywhere now: Brands climbing ladders. 
Brands apologizing for their founding truth. 
Brands chasing segments that were never theirs.

And you'll see the rare brand that refuses to climb.
That makes climbers look foolish.
That owns what it invented.

Nirma isn't a detergent company that needs to climb the premium ladder.
Nirma is the brand that invented affordable—and should own it like religion."
```

### Articulation Ledger
```
EXTERNALIZED:
- Scene: Conference room, premium recommendation (Maya translation)
- Anchor: Casio F-91W refusal to evolve (Habit counter-pattern)
- Principle: Ladder-refusal as disruption (Dharma translation)
- Return: Tactical application to Nirma (Coordinates × Principle)
- Diagnosis: MBA premiumization assumption (Samskara translation)
- Mark: "The Casio Position" (Identity shift translation)
```

## Part IV: Coherence Check

### Ledger Comparison

| Generation | Articulation | Match |
|------------|--------------|-------|
| Maya: Premium = survival | Scene: Consultant recommending premium | ✓ |
| Habit: Follow competitors | Anchor: Casio doing nothing | ✓ |
| POMDP: ₹6 → ₹68 chase | Return: ₹6 vs ₹68 comparison | ✓ |
| Attachment: "Serious brand" | Diagnosis: MBA assumption | ✓ |
| Dharma: Consistency > evolution | Principle: Ladder-refusal | ✓ |

### Reverse Translation Test

| Articulation Sentence | Traces To |
|-----------------------|-----------|
| "consultant explaining premiumize" | Maya.Vikshepa |
| "Casio refused to evolve" | Habit_Field counter-example |
| "ladder is the right game" | Dharma_Order.universalLaw |
| "every MBA case study" | Samskara.origin |
| "The Casio Position" | identityShift.insightName |

All sentences trace. ✓

### Orphan Check
- No orphan calculations (all generation items appeared in articulation)
- No orphan articulations (all sentences traced to calculations)

### Externalization Identity Check

**What was externalized?**

From Generation:
> "The consciousness configuration generating Nirma's decline: Maya veiling their actual market position, Habit automating premium-chase, Samskara of MBA 'premiumize or die' training."

From Articulation:
> "The pattern of climbing a ladder that isn't the right game. The fixation on premium when they invented affordable."

**Same thing expressed differently?** ✓

### Final Validation
```
COHERENT = TRUE
OUTPUT APPROVED
```

---

*End of Specification*

**Version:** 1.0
**Last Updated:** [Current Date]
**Builds On:** insight-generation-rulebook.txt, insight-generation-rules.json, insights.ts, OOF.txt
**Core Job:** EXTERNALIZATION — Make visible what the user is inside of
